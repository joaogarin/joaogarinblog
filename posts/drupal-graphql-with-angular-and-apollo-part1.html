<!doctype html>
<html lang="en">


<head>
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>joaogarin | Drupal GraphQL with Contenta, Angular and Apollo Part 1 - Authentication</title>
  <meta name="description" content="Getting started using Contenta with GraphQL powered by Apollo and Angular.">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="Drupal GraphQL with Contenta, Angular and Apollo Part 1 - Authentication">
  <meta property="og:type" content="website">
  <meta property="og:url" content="/posts/drupal-graphql-with-angular-and-apollo-part1">
  <meta property="og:description" content="Getting started using Contenta with GraphQL powered by Apollo and Angular.">
  <meta property="og:site_name" content="joaogarin">
  <meta property="og:image" content="/posts/net.jpg">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="/posts/drupal-graphql-with-angular-and-apollo-part1">
  <meta name="twitter:title" content="Drupal GraphQL with Contenta, Angular and Apollo Part 1 - Authentication">
  <meta name="twitter:description" content="Getting started using Contenta with GraphQL powered by Apollo and Angular.">
  <meta name="twitter:image" content="/posts/net.jpg">

  <link href="/feed.xml" type="application/rss+xml" rel="alternate" title="joaogarin Last 10 blog posts" />

  

  
    <link rel="icon" type="image/x-icon" href="/assets/favicon-light-a98c41efc5ed9fcc06ac664c9e2f7a9b3c3b2e0a52357d221fe382f6f4abc8fc.ico">
    <link rel="apple-touch-icon" href="/assets/apple-touch-icon-light-87d1f2a3a19b1500e5c1626a0492025ca5f7f97d24540dc5900288e92112925a.png">
    <link rel="stylesheet" type="text/css" href="/assets/light-bb1553a18d0f1ccfe1aabc010584c49b4277a88503216b78906ba719e30019c1.css">
  
</head>

<body>
  <main>
    <div class="grid grid-centered">
      <div class="grid-cell">
        <nav class="header-nav scrollappear">
  <a href="/" class="header-logo" title="joaogarin">joaogarin</a>
  <ul class="header-links">
    
      <li>
        <a href="/about" title="About me">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-about">
  <use href="/assets/about-ecf154b571ab8034ae00aeed91a3b7ad68db80b46d958753ad6216c919486e88.svg#icon-about" xlink:href="/assets/about-ecf154b571ab8034ae00aeed91a3b7ad68db80b46d958753ad6216c919486e88.svg#icon-about"></use>
</svg>

        </a>
      </li>
    
    
      <li>
        <a href="https://twitter.com/joaogarin" rel="noreferrer noopener" target="_blank" title="Twitter">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-twitter">
  <use href="/assets/twitter-8842c33965263ad1b03a978406826677a668f94125d5837e70ab83f24b3213a7.svg#icon-twitter" xlink:href="/assets/twitter-8842c33965263ad1b03a978406826677a668f94125d5837e70ab83f24b3213a7.svg#icon-twitter"></use>
</svg>

        </a>
      </li>
    
    
      <li>
        <a href="https://www.facebook.com/joao.garin" rel="noreferrer noopener" target="_blank" title="Facebook">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-facebook">
  <use href="/assets/facebook-72c99b26d37bee65607720abb23d26b44ef30cca1187f98b0d9305be1230b1bf.svg#icon-facebook" xlink:href="/assets/facebook-72c99b26d37bee65607720abb23d26b44ef30cca1187f98b0d9305be1230b1bf.svg#icon-facebook"></use>
</svg>

        </a>
      </li>
    
    
    
      <li>
        <a href="https://github.com/joaogarin" rel="noreferrer noopener" target="_blank" title="GitHub">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-github">
  <use href="/assets/github-094f81040819f34343ee6ffff0980f17e2807b08b595eaaf66ae3554934fd78d.svg#icon-github" xlink:href="/assets/github-094f81040819f34343ee6ffff0980f17e2807b08b595eaaf66ae3554934fd78d.svg#icon-github"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
      <li>
        <a href="https://www.linkedin.com/in/joao-garin-9b118525" rel="noreferrer noopener" target="_blank" title="LinkedIn">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-linkedin">
  <use href="/assets/linkedin-cdc5c107044324a3dfbea2e9ead15873f8dee304c37d73a046988956b706256e.svg#icon-linkedin" xlink:href="/assets/linkedin-cdc5c107044324a3dfbea2e9ead15873f8dee304c37d73a046988956b706256e.svg#icon-linkedin"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
      <li>
        <a href="/feed.xml" rel="noreferrer noopener" target="_blank" title="RSS">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-rss">
  <use href="/assets/rss-541ec5cea9cefd10d2fcfec01888f3f231a8829940249835fa7b7b3a12ae0d0d.svg#icon-rss" xlink:href="/assets/rss-541ec5cea9cefd10d2fcfec01888f3f231a8829940249835fa7b7b3a12ae0d0d.svg#icon-rss"></use>
</svg>

        </a>
      </li>
    
  </ul>
</nav>

        <article class="article scrollappear">
          <header class="article-header">
            <h1>Drupal GraphQL with Contenta, Angular and Apollo Part 1 - Authentication</h1>
            <p>Getting started using Contenta with GraphQL powered by Apollo and Angular.</p>
            <div class="article-list-footer">
              <span class="article-list-date">
                January 7, 2018
              </span>
              <span class="article-list-divider">-</span>
              <span class="article-list-minutes">
                
                
                  8 minute read
                
              </span>
              <span class="article-list-divider">-</span>
              <div class="article-list-tags">
                
                  <a href="/tag/web">web</a>
                
                  <a href="/tag/angular">angular</a>
                
                  <a href="/tag/javascript">javascript</a>
                
                  <a href="/tag/drupal">drupal</a>
                
              </div>
            </div>
          </header>

          <div class="article-content">
            <p><a href="/assets/posts/net-49570a3b914a81578880dd10320e19e0e8c982810872f38cd2616b83a2ec0eec.jpg" data-rjs="/assets/posts/net-49570a3b914a81578880dd10320e19e0e8c982810872f38cd2616b83a2ec0eec.jpg" class="fluidbox-trigger">
  <img src="/assets/posts/net-49570a3b914a81578880dd10320e19e0e8c982810872f38cd2616b83a2ec0eec.jpg" alt="net" />
</a></p>

<p>Lately I have been experimenting a lot with different setups for working in decoupled architectures with drupal and javascript. During 2017 I have joined efforts with <a href="https://twitter.com/johnmattdavis">Matt Davis</a> to create a <a href="https://github.com/contentacms/contenta_angular">Angular app</a> for <a href="http://www.contentacms.org/">Contenta</a> as one of the demos the distribution provides as default for new users, and also have been doing some side projects where I get to explore Contenta and decoupled drupal in general.</p>

<p>One of my goals for 2018 was to get started exploring <a href="http://graphql.org/">GraphQL</a>, which fits together perfectly with decoupled drupal. GraphQL is a query language by Facebook. It serves as a middleware between your client app and the server, making it super easy to understand as a frontend developer what you can query from the server, how responses are returned, caching strategies for fetching data and a lot more. For a more comprehensive description and feature set of GraphQL visit the <a href="http://graphql.org/">GraphQL site</a>.</p>

<p>In this post I want to focus on explaining how you can get started using <a href="http://graphql.org/">GraphQL</a> with <a href="https://www.drupal.org/">Drupal</a> using the <a href="https://github.com/drupal-graphql/graphql">Drupal GraphQL module</a> and <a href="https://github.com/apollographql/apollo-angular">Apollo Angular</a>.</p>

<p>I will go through three of the most common things when it comes to building an app using these technologies together :</p>

<ul>
  <li>Authentication</li>
  <li>Queries</li>
  <li>Mutations</li>
</ul>

<p>So let’s get started with part 1, Authentication!!</p>

<h2 id="full-code-samples">Full code samples</h2>

<p>The code samples can be found in Github. It includes all the frontend code and also the code for the custom mutations to be used with Drupal GraphQL.</p>

<p><a href="https://github.com/joaogarin/drupal-graphql-with-angular-and-apollo">Frontend code</a>
<a href="https://github.com/joaogarin/graphql_custom_mutations">Custom GraphQL mutation module</a></p>

<h2 id="install-contenta">Install Contenta</h2>

<p>The first thing we need to do is to have an installation of <a href="http://www.contentacms.org/">Contenta</a>. There are informations on the page how to install but you can run the quick install by running the following command :</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">php <span class="nt">-r</span> <span class="s2">"readfile('https://raw.githubusercontent.com/contentacms/contenta_jsonapi/8.x-1.x/installer.sh');"</span> <span class="o">&gt;</span> contentacms.sh
<span class="nb">chmod </span>a+x contentacms.sh
./contentacms.sh</code></pre></figure>

<p>One you have installed Contenta, the Drupal graphql module will already be available for you to start using. It is an experimental module in Contenta so take your cautions while using it although it works pretty well and it’s already used in production by several companies.</p>

<h3 id="graphql-explorer">Graphql explorer</h3>

<p>One of the awesome things graphql module brings is installing by default <a href="https://github.com/graphql/graphiql">GraphiQL</a>. Visit <code class="highlighter-rouge">http://yourwebsiteurl/graphql/explorer</code> and you will see GraphiQL there :</p>

<p><a href="/assets/posts/graphiql-ffc264686a21686b63a44bf943d8fc4159dd509aa5b9021b53e8f8cb865d3631.png" data-rjs="/assets/posts/graphiql-ffc264686a21686b63a44bf943d8fc4159dd509aa5b9021b53e8f8cb865d3631.png" class="fluidbox-trigger">
  <img src="/assets/posts/graphiql-ffc264686a21686b63a44bf943d8fc4159dd509aa5b9021b53e8f8cb865d3631.png" alt="graphiql" />
</a></p>

<p>GraphiQL is like a playground for you to start experimenting with GraphQL queries without having to setup anything. You can run queries, mutations, explore the API giving you all the information you need to experiment without having to setup a frontend.</p>

<p>At this point you didn’t have to configure or setup anything at all, and you have a working setup of Drupal and Graphql, ready to receive queries. Pretty cool hein?</p>

<p>Lets go deeper and start setting up a frontend and configure things for authentication, querying and mutations.</p>

<h2 id="create-your-angular-frontend">Create your Angular frontend</h2>

<p>The first thing we need to do in order to get started with our frontend is to create our angular app. Using the <a href="https://github.com/angular/angular-cli">Angular CLI</a> this is essentially just running :</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">ng</span> <span class="k">new</span> <span class="nx">PROJECT</span><span class="o">-</span><span class="nx">NAME</span></code></pre></figure>

<p>And we have our angular app. The next step is to setup authentication using drupal <a href="https://www.drupal.org/project/simple_oauth">simple auth module</a> and <a href="https://github.com/manfredsteyer/angular-oauth2-oidc">OAuth 2 and OpenId Connect (OIDC)</a>.</p>

<h2 id="authentication">Authentication</h2>

<p>Because Drupal’s <a href="https://www.drupal.org/project/simple_oauth">simple auth module</a> is built around Oauth2 we can easily leverage libraries to make it easier to handle authentication on the frontend, in this example I will be using <a href="https://github.com/manfredsteyer/angular-oauth2-oidc">OAuth 2 and OpenId Connect (OIDC)</a> but you could easily use any other or even none and do it all by yourself.</p>

<p>Another great thing about <a href="http://graphql.org/">GraphQL</a> is that using authentication works exactly like it does in any HTTP-like environment, using common strategies and standards as for example oauth2.</p>

<h3 id="configuring-simple-auth">Configuring simple auth</h3>

<p>The first thing we need to do with Contenta in order to get authentication working is setting up the simple auth module to handle authentication. Because <a href="https://twitter.com/e0ipso">Mateu Aguiló Bosch</a> has such <a href="https://www.youtube.com/watch?v=rTcC0maPLSA&amp;list=PLZOQ_ZMpYrZtqy5-o7KoDhM3n6M0duBjX">great tutorials</a> about how to setup simple auth (all available in Contenta’s tutorials btw) I won’t go through this here to save some time in the blog post. All I can say is I just followed it step by step and it worked great. For this post and in this use case I have used <a href="https://www.youtube.com/watch?v=sZbzcCXMmEA&amp;list=PLZOQ_ZMpYrZtqy5-o7KoDhM3n6M0duBjX&amp;index=9">implicit grant</a> as the method for authentication.</p>

<p>There are however a couple things I found could go a bit more “wrong” when setting this up so make sure to pay attention to :</p>

<ul>
  <li>Private and public key’s permissions (warnings will be give in reports if configured wrong)</li>
  <li>make sure the role for the user has permissions to simple auth extras (“Allow using the AuthCode grant”)</li>
</ul>

<p>At this point authentication is setup on the server (Drupal) and we can move on to configuring it on the client.</p>

<h3 id="configuring-angular-oauth2">Configuring Angular Oauth2</h3>

<p>For connecting Angular to our Drupal backend we will be using <a href="https://github.com/manfredsteyer/angular-oauth2-oidc">OAuth 2 and OpenId Connect (OIDC)</a>.</p>

<p>The first thing to be done is import the NgModule provided by the package in our application. In your app.module.ts file (in src/app) add the NgModule :</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">import</span> <span class="p">{</span> <span class="nx">OAuthModule</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">angular-oauth2-oidc</span><span class="dl">'</span><span class="p">;</span>
<span class="p">[...]</span>

<span class="p">@</span><span class="nd">NgModule</span><span class="p">({</span>
  <span class="na">imports</span><span class="p">:</span> <span class="p">[</span> 
    <span class="p">[...]</span>
    <span class="nx">HttpModule</span><span class="p">,</span>
    <span class="nx">OAuthModule</span><span class="p">.</span><span class="nx">forRoot</span><span class="p">()</span>
  <span class="p">],</span>
  <span class="na">declarations</span><span class="p">:</span> <span class="p">[</span>
    <span class="nx">AppComponent</span><span class="p">,</span>
    <span class="nx">HomeComponent</span><span class="p">,</span>
    <span class="p">[...]</span>
  <span class="p">],</span>
  <span class="na">bootstrap</span><span class="p">:</span> <span class="p">[</span>
    <span class="nx">AppComponent</span> 
  <span class="p">]</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">AppModule</span> <span class="p">{</span>
<span class="p">}</span></code></pre></figure>

<p>Next we will follow the <a href="https://github.com/manfredsteyer/angular-oauth2-oidc#configuring-for-implicit-flow">instructions</a> to configure the module for implicit flow by providing a auth.config.ts file that the package will use. this file can be located in the src/app/ folder.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">import</span> <span class="p">{</span> <span class="nx">environment</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./../environments/environment</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">AuthConfig</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">angular-oauth2-oidc</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">authConfig</span><span class="p">:</span> <span class="nx">AuthConfig</span> <span class="o">=</span> <span class="p">{</span>

  <span class="c1">// Url of the Identity Provider</span>
  <span class="na">loginUrl</span><span class="p">:</span> <span class="s2">`</span><span class="p">${</span><span class="nx">environment</span><span class="p">.</span><span class="nx">contenta_url</span><span class="p">}</span><span class="s2">/oauth/authorize`</span><span class="p">,</span>

  <span class="c1">// URL of the SPA to redirect the user to after login</span>
  <span class="na">redirectUri</span><span class="p">:</span> <span class="dl">'</span><span class="s1">http://localhost:4200/</span><span class="dl">'</span><span class="p">,</span>

  <span class="c1">// The SPA's id. The SPA is registerd with this id at the auth-server</span>
  <span class="na">clientId</span><span class="p">:</span> <span class="dl">'</span><span class="s1">YOUR_CLIENT_ID_PROVIDED_IN_SIMPLE_AUTH_CLIENT</span><span class="dl">'</span><span class="p">,</span>

  <span class="c1">// set the scope for the permissions the client should request</span>
  <span class="c1">// The first three are defined by OIDC. The 4th is a usecase-specific one</span>
  <span class="na">scope</span><span class="p">:</span> <span class="dl">'</span><span class="s1">content_administrator</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">oidc</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="na">strictDiscoveryDocumentValidation</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="na">showDebugInformation</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">}</span></code></pre></figure>

<p>A couple of things to note here :</p>

<p>First we provide the url of Contenta so that when logging in you are redirected to that url in order to authenticate.</p>

<p>You also need to provide a redirectUrl which is where the user will be redirected once login ends, we provide the default location of our app (if you are using a different url or port make sure to change this).</p>

<p>The last important thing to notice here is the scope, if you have watched the videos mentioned above on how to setup simple_auth you have <a href="https://www.youtube.com/watch?v=-xRBJvmg0qQ&amp;list=PLZOQ_ZMpYrZtqy5-o7KoDhM3n6M0duBjX&amp;index=4">seen that you must create roles</a>, which will give simple auth the necessary information about a user’s roles and what he has access to.</p>

<p>The configuration has a couple of extra options you can use so make sure to refer to the <a href="https://github.com/manfredsteyer/angular-oauth2-oidc">official documentation</a> for more information on all the possible options.</p>

<p>Now we need to connect the config with the app in our app’s root component (app.component.ts) :</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@angular/core</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">OAuthService</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">angular-oauth2-oidc</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">JwksValidationHandler</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">angular-oauth2-oidc</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">authConfig</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./auth.config</span><span class="dl">'</span><span class="p">;</span>

<span class="p">@</span><span class="nd">Component</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="dl">'</span><span class="s1">app-root</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">templateUrl</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./app.component.html</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">styleUrls</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">./app.component.css</span><span class="dl">'</span><span class="p">]</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">AppComponent</span> <span class="p">{</span>
  <span class="nx">title</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">app</span><span class="dl">'</span><span class="p">;</span>
  <span class="nx">authenticated</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

  <span class="kd">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">oauthService</span><span class="p">:</span> <span class="nx">OAuthService</span><span class="p">,</span> <span class="kr">public</span> <span class="nx">apollo</span><span class="p">:</span> <span class="nx">Apollo</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">configureWithNewConfigApi</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="kr">private</span> <span class="nx">configureWithNewConfigApi</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">oauthService</span><span class="p">.</span><span class="nx">configure</span><span class="p">(</span><span class="nx">authConfig</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">oauthService</span><span class="p">.</span><span class="nx">setStorage</span><span class="p">(</span><span class="nx">sessionStorage</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">oauthService</span><span class="p">.</span><span class="nx">tryLogin</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">_</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">authenticated</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">oauthService</span><span class="p">.</span><span class="nx">hasValidAccessToken</span><span class="p">();</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="kr">public</span> <span class="nx">login</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">oauthService</span><span class="p">.</span><span class="nx">initImplicitFlow</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="kr">public</span> <span class="nx">logoff</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">oauthService</span><span class="p">.</span><span class="nx">logOut</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">authenticated</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Now we just need our template to call the login and logout methods :</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;h1&gt;</span>
  Hello Contenta Graphql
<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;div</span> <span class="na">*ngIf=</span><span class="s">"authenticated;else unauth"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;h2&gt;</span>Status : Authenticated<span class="nt">&lt;/h2&gt;</span>
  <span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">*ngIf=</span><span class="s">"authenticated"</span> <span class="na">class=</span><span class="s">"btn btn-default"</span> <span class="na">(click)=</span><span class="s">"logoff()"</span><span class="nt">&gt;</span>
      Logout
    <span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;ng-template</span> <span class="na">#unauth</span><span class="nt">&gt;</span>
  <span class="nt">&lt;h2&gt;</span>Status : Anonymous<span class="nt">&lt;/h2&gt;</span>
  <span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">*ngIf=</span><span class="s">"!authenticated"</span> <span class="na">class=</span><span class="s">"btn btn-default"</span> <span class="na">(click)=</span><span class="s">"login()"</span><span class="nt">&gt;</span>
      Login
    <span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/ng-template&gt;</span></code></pre></figure>

<p>That’s it!! At this point authentication is working. You should be able to run the app by running :</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">npm start</code></pre></figure>

<p>and click the button “login” in order to get redirected to Contenta, provide your authentication credentials and get redirected back to the app. The token provided by simple auth is then registered in the oauth package we used and you can access it inside your app by doing :</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">oauthService</span><span class="p">.</span><span class="nx">getAccessToken</span><span class="p">()</span></code></pre></figure>

<p>In the <a href="/posts/drupal-graphql-with-angular-and-apollo-part2">next post</a> we  will see how you can connect Apollo and GraphQL to our authentication in order to provide authorization / controlled access for Queries and Mutations.</p>

          </div>
          <div class="article-share">
            
            
            <a href="https://twitter.com/home?status=Drupal+GraphQL+with+Contenta,+Angular+and+Apollo+Part+1+-+Authentication%20-%20/posts/drupal-graphql-with-angular-and-apollo-part1%20by%20@joaogarin" title="Share on Twitter" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M492 109.5c-17.4 7.7-36 12.9-55.6 15.3 20-12 35.4-31 42.6-53.6 -18.7 11.1-39.4 19.2-61.5 23.5C399.8 75.8 374.6 64 346.8 64c-53.5 0-96.8 43.4-96.8 96.9 0 7.6 0.8 15 2.5 22.1 -80.5-4-151.9-42.6-199.6-101.3 -8.3 14.3-13.1 31-13.1 48.7 0 33.6 17.2 63.3 43.2 80.7C67 210.7 52 206.3 39 199c0 0.4 0 0.8 0 1.2 0 47 33.4 86.1 77.7 95 -8.1 2.2-16.7 3.4-25.5 3.4 -6.2 0-12.3-0.6-18.2-1.8 12.3 38.5 48.1 66.5 90.5 67.3 -33.1 26-74.9 41.5-120.3 41.5 -7.8 0-15.5-0.5-23.1-1.4C62.8 432 113.7 448 168.3 448 346.6 448 444 300.3 444 172.2c0-4.2-0.1-8.4-0.3-12.5C462.6 146 479 129 492 109.5z"/></svg>
            </a>
            <a href="https://www.facebook.com/sharer/sharer.php?u=/posts/drupal-graphql-with-angular-and-apollo-part1" title="Share on Facebook" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M288 192v-38.1c0-17.2 3.8-25.9 30.5-25.9H352V64h-55.9c-68.5 0-91.1 31.4-91.1 85.3V192h-45v64h45v192h83V256h56.4l7.6-64H288z"/></svg>
            </a>
            <a href="https://plus.google.com/share?url=/posts/drupal-graphql-with-angular-and-apollo-part1" title="Share on Google+" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 128 128"><path d="M40.7 55.9v16.1c0 0 15.6 0 22 0C59.2 82.5 53.8 88.2 40.7 88.2c-13.3 0-23.7-10.8-23.7-24.2s10.4-24.2 23.7-24.2c7.1 0 11.6 2.5 15.8 5.9 3.3-3.3 3.1-3.8 11.6-11.9 -7.2-6.6-16.8-10.6-27.4-10.6C18.2 23.3 0 41.5 0 64c0 22.5 18.2 40.7 40.7 40.7 33.6 0 41.8-29.3 39-48.8H40.7zM113.9 56.7V42.6h-10.1v14.1H89.4v10.1h14.5v14.5h10.1V66.8H128V56.7H113.9z"/></svg>
            </a>
          </div>

          
            <div id="disqus_thread" class="article-comments"></div>
            <script src="https://joaogarinblog.disqus.com/embed.js" async defer></script>
            <noscript>Please enable JavaScript to view the comments.</noscript>
          
        </article>
        <footer class="footer scrollappear">
  <p>
    This site is powered by Jekyll and Chalk theme. All content rights reserved to 
    <a href="/about" title="About me">Joao Garin</a>.
  </p>
</footer>

      </div>
    </div>
  </main>
  

<script src="/assets/vendor-130c9c254effc51f3283620bc635851da7b99c20901216948f11ba72ee13317f.js" type="text/javascript"></script>


  <script src="/assets/webfonts-96493456d319d1bf419afdf8701552d4d486fee6afd304897d4fd81eb4e0cc0b.js" type="text/javascript"></script>



  <script src="/assets/scrollappear-e2da8ea567e418637e31266cc5302126eaa79f62a2273739086358b589a89ee6.js" type="text/javascript"></script>


<script src="/assets/application-cfde13ac81ddaf4351b2e739603e2baf688d0fcc9aba613fe62bbb1c7b037fb9.js" type="text/javascript"></script>

</body>
</html>
